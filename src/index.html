<!DOCTYPE html>
<html lang="kr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://raw.githubusercontent.com/kh1012/sproj-std/main/files/favicon.ico" />
  <title>html simple input</title>
</head>
<body style="padding: 10px">
  <!-- SCRIPT 동작 코드 -->
  <script type="text/javascript">
    // API를 사용하기 위한 기본적인 변수 및 함수
    const baseUrl = 'https://api-beta.rpm.kr-dv-midasit.com:443';
    const programType = 'gen';
    function getMapiKey() {
      // url에서 params를 가져오고 mapikey를 get 합니다.
      const params = new URLSearchParams(window.location.search);
      return params.get("mapikey");
    }

    // QueryString을 만드는 함수
    function makeQueryString() {
      const inputValue = document.getElementById('querystring-input').value;
      const queryString = '?mapikey=' + inputValue;
      document.getElementById('querystring-output').textContent = queryString;
    }

    // 만들어진 QueryString을 주소창에 적용 시켜주는 함수
    function queryStringToURL() {
      const href = window.location.href;
      if (!href.includes('?mapikey=')) {
        window.location.href = 
          window.location.href + document.getElementById('querystring-output').textContent;
      }
    }

    // MAPI-Key가 올바른지 확인하는 함수
    function checkMapiKey() {
      async function doWork() {
        // mapikey를 QueryString으로부터 가져 옵니다.
        const mapikey = getMapiKey();

        const response = await fetch(`${baseUrl}/mapikey/verify`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'MAPI-Key': mapikey
          }
        });

        // 응답 결과를 getnode-output id를 가진 DOM 객체에 전달합니다.
        document.getElementById('status-output').textContent = 
          JSON.stringify(await response.json(), null, 2);
      }

      doWork();      
    }

    //GET NODE 함수
    function getNodeFetch() {
      async function doWork() {
        // mapikey를 QueryString으로부터 가져 옵니다.
        const mapikey = getMapiKey();

        // NODE를 가져오는 요청을 보냅니다.
        const response = await fetch(`${baseUrl}/${programType}/db/node`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'MAPI-Key': mapikey
        }});

        // 응답 결과를 getnode-output id를 가진 DOM 객체에 전달합니다.
        document.getElementById('getnode-output').textContent = 
          JSON.stringify(await response.json(), null, 2);
      }

      doWork();
    }
  </script>

  <div>
    <!-- TITLE -->
    <h1>HTML SIMPLE INPUT</h1>

    <!-- EXAMPLE -->
    <ul>
      <li style="margin-bottom: 10px">
        아래 Edit Box에 MAPI-Key를 넣고 <b>QueryString을 만들어 보세요.</b>
        <div style="margin-top: 10px; margin-bottom: 10px">
          <input type="text" id="querystring-input" />
          <button type="button" style="margin-left: 10px" onclick="makeQueryString()">QueryString 만들기</button>
          <pre id='querystring-output' style="margin-bottom: 10px"></pre>
          <p>위 문자열을 복사해서 주소창에 직접 붙여넣기 + Enter 하시거나 <button type="button" onclick="queryStringToURL()">QueryString 적용하기 (To URL)</button>를 눌러주세요.</p>
          <p>브라우저의 주소창을 보시면 mapikey가 적용된 걸 보실 수 있습니다.</p>
        </div>
      </li>
      <li style="margin-bottom: '10px'">
        MAPI-Key가 올바른 형태인지 확인하세요.
        <div style="margin-top: 10px">
          <button type="button" onclick="checkMapiKey()">MAPI-Key 확인</button>
          <pre id='status-output'></pre>
        </div>
      </li>
      <!-- CLIENT의 NODE 정보를 가져와서 출력 -->
      <li style="margin-bottom: 10px">
        03. <b>"GET"</b> 아래 버튼을 클릭하시면 NODE 정보를 가져옵니다.
        <div style="margin-top: 10px">
          <button type="button" onclick="getNodeFetch()">GET NODE</button>
          <pre id="getnode-output"></pre>
        </div>
      </li>
    </ul>
  </div>
</body>
</html>